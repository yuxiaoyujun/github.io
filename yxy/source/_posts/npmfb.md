---
title: 【npm】npm发布步骤
date: 2023-03-28 11:36:08
tags: npm
categories: 程序员的自我修养
---

## npm包发布
发布一个npm包通常需要以下步骤：

1. 确保你已经安装了`Node.js`和`npm`，以及在`npm`上注册了一个账户。如果没有，请先在[https://www.npmjs.com/](https://www.npmjs.com/)上注册一个账户。
2. 在终端中创建一个新的项目文件夹，并进入该文件夹。执行以下命令来初始化npm包：

```
npm init
```

3. 在你的项目文件夹中编写代码，并确保在`package.json`文件中指定了正确的入口文件路径和依赖项。
4. 编写`README`文件和许可证文件，并确保它们在项目文件夹中。
5. 在终端中运行以下命令来登录npm账户:

```
npm login
```

6. 输入你的用户名、密码和电子邮件地址。如果一切顺利，你将登录成功（若无法登录，请看看“可能遇到的问题”部分）。
7. 在终端中运行以下命令，将包发布到npm上:

```
npm publish
```

这将把你的npm包上传到npm仓库。你的包将被分配一个唯一的版本号，并且其他人可以通过npm来安装你的包。如果你需要更新你的包，只需更新代码，修改版本号并再次运行`npm publish`命令即可。

请注意，当你发布npm包时，你的代码将被公开发布到npm上。因此，你应该小心保护敏感信息，并确保遵循最佳实践，以确保代码的安全性和稳定性。

## npm包删除

如果你想删除自己发布的npm包，可以在终端中使用以下命令：

```
npm unpublish <package-name> --force
```

**请注意，<span style="background-color:#78a355	">删除一个包是不可逆转的</span>，因此请确保你真正需要删除它，以避免造成不必要的损失。**

#### 其他注意事项：
1. 删除已发布的npm包会破坏其他人对你的代码的依赖，因此在删除之前，请确保没有人正在使用你的代码，或者提供足够的警告时间，以便其他人可以切换到其他代码。
2. 如果你已经发布了<span style="background-color:#78a355	">多个版本</span>的npm包，则只能删除<span style="background-color:#78a355	">最新的版本</span>，<span style="background-color:#78a355	">不能删除旧版本</span>。
3. 删除npm包需要管理员权限，因此你需要确保你的账户拥有管理员权限，才能删除你发布的包。

## 可能遇到的问题

如果你执行 `npm login` 命令时出现错误，可能是以下几种情况之一：

1. 检查你的npm账户是否已注册。如果你还没有npm账户，你需要先在npm的官方网站上注册一个账户。

2. 检查你的网络连接是否正常。如果你的网络连接不稳定或者有问题，可能导致登录失败。

3. 检查你的npm注册表是否正确。如果你要登录的是npm的私有注册表，确保你已经订阅了npm付费计划，以便可以创建一个私有注册表，并通过该私有注册表来发布私有包。

4. 检查你的npm配置是否正确。你可以在命令行中运行以下命令，查看npm的配置信息：

   ```
   npm config list
   ```

   确保你的 `registry` 配置是正确的。如果你要登录的是npm的私有注册表，确保你的 `registry` 配置是指向该私有注册表的。

如果你已经确认了以上的问题，并且你的 `npm login` 命令仍然失败，你可以尝试以下几种方法：

1. 清除npm的缓存。你可以使用以下命令来清除npm的缓存：

   ```
   npm cache clean --force
   ```

   清除缓存后，尝试再次登录。

2. 检查npm的版本。确保你正在使用的是最新版本的npm。

3. 如果你使用的是代理服务器，你可以尝试在命令行中设置代理服务器。例如：

   ```
   npm config set proxy http://yourproxy:yourport
   npm config set https-proxy http://yourproxy:yourport
   ```

   将 `yourproxy` 替换为你的代理服务器地址，将 `yourport` 替换为你的代理服务器端口号。

如果你仍然无法成功登录，你可以查看npm的官方文档或者向npm的技术支持团队寻求帮助。

#### 关于第四点，确认是否使用私有注册表的补充

**因为很多人使用的是<span style="background-color:#78a355	;">国内淘宝镜像</span>以至于`npm login`不成功，此时只需要改为<span style="background-color:#78a355	">官方镜像</span>即可。**

#### 具体方法如下：

要确认是否使用私有注册表，你可以检查你的npm配置文件。默认情况下，npm会将你的包发布到npm官方的公共注册表，而不是私有注册表。如果你要使用私有注册表，你需要订阅npm的付费计划，并创建一个私有注册表。在登录时，你需要使用该私有注册表的URL。

要检查你的npm配置是否指向私有注册表，可以运行以下命令：

```
npm config get registry
```

如果输出的结果是私有注册表的URL，那么你正在使用私有注册表。如果输出的结果是默认的公共注册表URL（`https://registry.npmjs.org/`），那么你不是在使用私有注册表。

如果你确定你要使用私有注册表，但无法成功登录，那么可能是因为你的npm配置不正确。确保你已经在npm上订阅了付费计划，并创建了一个私有注册表。在登录时，你需要使用该私有注册表的URL，并提供正确的访问凭据。如果你仍然无法成功登录，你可以联系npm的技术支持团队，寻求帮助。

#### 如何更改？

你可以通过 `npm config set` 命令来更改npm的配置。例如，要将npm配置的注册表更改为私有注册表的URL，可以使用以下命令：

```
npm config set registry <your-private-registry-url>
```

其中 `<your-private-registry-url>` 是你的私有注册表的URL。你需要将其替换为你的实际URL。

如果你想将npm配置恢复为默认设置，可以使用以下命令：

```
npm config delete registry
```

这将删除当前配置的 `registry` 选项，使npm使用默认的公共注册表。

## 发布一个私有的npm包

1. 使用npm收费工具

如果你希望仅向付费用户提供访问权限，你可以使用npm的付费工具。你可以在npm网站上注册一个付费账户，创建一个收费组织，然后将你的包添加到该组织中。然后，你可以设置访问权限，仅允许那些已经付费的用户使用你的包。

2. 使用npm访问令牌

另一种方法是使用npm访问令牌。你可以创建一个令牌，并将其授予仅限于你允许的用户。然后，你可以将该令牌用于安装你的包。只有持有该令牌的用户才能使用你的包。你可以在npm网站上创建一个访问令牌，并将其添加到你的项目中的`.npmrc`文件中。请确保令牌不被泄露，以避免未经授权的用户使用你的代码。

3. 使用私有npm仓库（类似[淘宝镜像源](**https://registry.npmmirror.com**)的服务器，但其实淘宝镜像源是公开的）

最后，你可以使用私有npm仓库。你可以在你自己的服务器上搭建一个npm仓库，并将你的包上传到该仓库中。然后，你可以设置访问权限，只有你允许的用户才能访问该仓库并安装你的包。你可以使用像Sinopia、Verdaccio等这样的开源工具来搭建私有npm仓库。

1、3都属于人民币玩家的方式，这俩方式就不说了

## 使用npm访问令牌

第二种方法是使用npm访问令牌。你可以创建一个令牌，授予仅限于你允许的用户，并将该令牌用于安装你的npm包。以下是实现此目的的详细步骤：

1. 首先，你需要在npm上注册一个账户。如果你还没有注册，请在https://www.npmjs.com/上注册一个账户。
2. 接下来，你需要创建一个npm访问令牌。你可以使用以下命令在终端中创建一个访问令牌：

```
npm token create --read-write <registry-url>
```

`<registry-url>`是指你要发布npm包的npm仓库的地址。例如，如果你要发布到npm官方仓库，那么这个值应该是https://registry.npmjs.org/。如果你要发布到私有仓库，那么这个值应该是你的私有仓库地址。

1. 执行以上命令后，npm将提示你输入你的npm账户的用户名和密码。输入正确的用户名和密码后，npm将生成一个新的访问令牌，并将其输出到终端中。
2. 将新生成的访问令牌添加到你的`.npmrc`文件中。`.npmrc`文件通常位于你的用户目录下。在`.npmrc`文件中添加以下内容：

```
//<registry-url>/:_authToken=<access-token>
```

`<registry-url>`是你要发布npm包的npm仓库地址，`<access-token>`是你新生成的访问令牌。

1. 将你的npm包发布到npm仓库。你可以使用以下命令将你的包发布到npm仓库中：

```
npm publish --registry=<registry-url>
```

`<registry-url>`是你要发布的npm仓库地址，可以是npm官方仓库或者私有仓库。

1. 现在，只有持有你的访问令牌的用户才能访问和安装你的npm包。你可以将访问令牌授予你允许的用户，或者在需要时撤销该令牌的访问权限。

请注意，访问令牌是一个非常重要的凭证，因此你需要妥善保管它，不要将它泄露给未经授权的用户。如果你怀疑你的令牌已经被泄露，那么你应该立即撤销该令牌，并生成一个新的访问令牌。

